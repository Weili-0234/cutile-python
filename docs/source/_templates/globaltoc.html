<!--
SPDX-FileCopyrightText: Copyright (c) <2025> NVIDIA CORPORATION & AFFILIATES. All rights reserved.

SPDX-License-Identifier: Apache-2.0
-->

{# Custom global table of contents template based on the NVIDIA/PyData theme #}
<nav class="bd-docs-nav bd-links" aria-label="{{ _('Table of Contents') }}">
  <p class="bd-links__title" role="heading" aria-level="1">{{ _("Table of Contents") }}</p>
  <div class="bd-toc-item navbar-nav">
    {{ toctree(
        maxdepth=2,
        collapse=False,
        includehidden=True
      )
    }}
  </div>
</nav>

<script type="text/javascript">
  document.addEventListener('DOMContentLoaded', function() {
    // Find all items that have children
    const tocItems = document.querySelectorAll('.bd-toc-item .toctree-l1');

    tocItems.forEach(function(item) {
      // Check if the item has child items (a nested list)
      const sublist = item.querySelector('ul');
      if (sublist) {
        // Add class to indicate it has children
        item.classList.add('has-children');

        // Create a toggle button with a simple span that will be styled with CSS
        const toggleButton = document.createElement('button');
        toggleButton.className = 'toc-toggle-btn';
        toggleButton.id = 'toggle-' + Math.random().toString(36).substring(2, 9);

        // Instead of Font Awesome, use a simple span with a text arrow
        const arrowElem = document.createElement('span');
        arrowElem.className = 'arrow-icon';

        // Start with up arrow (collapsed state)
        arrowElem.textContent = '▲';
        toggleButton.appendChild(arrowElem);

        item.appendChild(toggleButton);

        // Start with sections collapsed (no 'current' class)
        // Exception: Add 'current' class to ancestor of current page to keep it expanded
        if (!item.classList.contains('current')) {
          // Hide sublist manually with CSS
          sublist.style.display = 'none';
        } else {
          // This is an ancestor of the current page, keep it expanded
          arrowElem.textContent = '▼';
        }

        // Add click handler to toggle button
        toggleButton.onclick = function(e) {
          // Toggle expanded state by toggling display of sublist
          if (sublist.style.display === 'none') {
            sublist.style.display = 'block';
            arrowElem.textContent = '▼';
            item.classList.add('current');
          } else {
            sublist.style.display = 'none';
            arrowElem.textContent = '▲';
            item.classList.remove('current');
          }

          e.preventDefault();
          e.stopPropagation();
        };
      }
    });
  });
</script>
